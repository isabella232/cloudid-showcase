apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: vault
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: vault
        instance: vault
    spec:
      containers:
        - name: vault
          image: "vault:0.9.6"
#          resources:
#            requests:
#              cpu: 300m
#              memory: 1000Mi
#            limits:
#              cpu: 300m
#              memory: 1500Mi
          command:
          - vault
          - server
          - -config
          - /vault/config/vault.conf
          ports:
          - containerPort: 8200
            name: main-port
          - containerPort: 8300
            name: healthcheck
          readinessProbe:
            httpGet:
              # TODO: Review
              path: /v1/sys/health
              port: 8300
            initialDelaySeconds: 5
            timeoutSeconds: 1
          volumeMounts:
              - name: vault-config
                mountPath: /vault/config
                readOnly: true
              - name: vault-secrets
                mountPath: /vault/secrets
                readOnly: true
              - name: vault-file
                mountPath: /vault/file
              - name: vault-logs
                mountPath: /vault/logs
      volumes:
        - name: vault-config
          configMap:
            name: vault-config
            items:
            - key: vault.conf
              path: vault.conf
        - name: vault-secrets
          secret:
            secretName: vault-secrets
        - name: vault-logs
          emptyDir: {}
        - name: vault-file
          emptyDir: {}
